@model IMS.Application.DTOs.DashboardDto

@{
    ViewData["Title"] = "Dashboard";
}

<div class="container-fluid">
    <div class="row">
        <div class="page-title-box d-flex align-items-center justify-content-between">
            <h4 class="mb-0">Inventory Management Dashboard</h4>
        </div>
    </div>

    <div class="row">
        <!-- Total Products -->
        <div class="col-md-6 col-xl-4 mt-2">
            <div class="card">
                <div class="card-body">
                    <div class="float-end mt-2">
                        <div id="totalProductsRadialChart" data-colors='["--bs-success"]'></div>
                    </div>
                    <div>
                        <p class="text-muted mb-0">Total Products</p>
                        <h4 class="my-1">
                            <span id="spanTotalProducts">@Model.TotalProducts</span>
                        </h4>
                    </div>
                    <p class="text-muted mt-3 mb-0">Current inventory items</p>
                </div>
            </div>
        </div>

        <!-- Total Orders -->
        <div class="col-md-6 col-xl-4 mt-2">
            <div class="card">
                <div class="card-body">
                    <div class="float-end mt-2">
                        <div id="totalOrdersRadialChart" data-colors='["--bs-warning"]'></div>
                    </div>
                    <div>
                        <p class="text-muted mb-0">Total Orders</p>
                        <h4 class="my-1">
                            <span id="spanTotalOrders">@Model.TotalOrders</span>
                        </h4>
                    </div>
                    <p class="text-muted mt-3 mb-0">
                        Completed: @Model.CompletedOrders | Pending: @Model.PendingOrders
                    </p>
                </div>
            </div>
        </div>

        <!-- Total Inventory -->
        <div class="col-md-6 col-xl-4 mt-2">
            <div class="card">
                <div class="card-body">
                    <div class="float-end mt-2">
                        <div id="totalInventoryRadialChart" data-colors='["#F0006B"]'></div>
                    </div>
                    <div>
                        <p class="text-muted mb-0">Total Inventory Items</p>
                        <h4 class="my-1">
                            <span id="spanTotalInventory">@Model.TotalInventory</span>
                        </h4>
                    </div>
                    <p class="text-muted mt-3 mb-0">
                        Low Stock Items: <span class="text-warning">@Model.LowStockItems</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Top Selling Product -->
        <div class="col-md-6 col-xl-4 mt-2">
            <div class="card">
                <div class="card-body">
                    <div class="float-end mt-2">
                        <i class="fas fa-award fa-2x text-primary"></i>
                    </div>
                    <div>
                        <p class="text-muted mb-0">Top Selling Product</p>
                        <h4 class="my-1">@Model.TopSellingProductName</h4>
                    </div>
                    <p class="text-muted mt-3 mb-0">
                        Total Sold: @Model.TopSellingProductQuantity units
                    </p>
                </div>
            </div>
        </div>

        <!-- Warehouses and Customers -->
        <div class="col-md-6 col-xl-4 mt-2">
            <div class="card">
                <div class="card-body">
                    <div>
                        <p class="text-muted mb-0">Business Overview</p>
                    </div>
                    <div class="mt-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Warehouses</span>
                            <span class="fw-bold">@Model.TotalWarehouses</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Customers</span>
                            <span class="fw-bold">@Model.TotalCustomers</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Suppliers</span>
                            <span class="fw-bold">@Model.TotalSuppliers</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Categories</span>
                            <span class="fw-bold">@Model.TotalCategories</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transaction Summary - UPDATED -->
        <div class="col-md-6 col-xl-4 mt-2">
            <div class="card">
                <div class="card-body">
                    <div>
                        <p class="text-muted mb-0">Transaction Summary</p>
                    </div>
                    <div class="mt-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span><i class="fas fa-arrow-down text-success me-1"></i> In Transactions</span>
                            <span class="fw-bold" id="spanInTransactions">@Model.InTransactions</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span><i class="fas fa-arrow-up text-danger me-1"></i> Out Transactions</span>
                            <span class="fw-bold" id="spanOutTransactions">@Model.OutTransactions</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span><i class="fas fa-exchange-alt text-info me-1"></i> Warehouse Transfers</span>
                            <span class="fw-bold" id="spanWarehouseTransfers">@Model.WarehouseTransfers</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Total Transactions</span>
                            <span class="fw-bold" id="spanTotalTransactions">@Model.TotalInventoryTransactions</span>
                        </div>
                        <div class="mt-2 pt-2 border-top">
                            <div class="d-flex justify-content-between">
                                <span>Recent (7 days)</span>
                                <span class="fw-bold">@Model.RecentTransactions</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart for Inventory Distribution -->
        <div class="col-md-12 col-xl-8 mt-2">
            <div class="card">
                <div class="card-body">
                    <div>
                        <p class="text-muted mb-0">Inventory Analytics</p>
                    </div>
                    <div id="inventoryAnalyticsChart" data-colors='["--bs-warning","--bs-primary"]'></div>
                    <div class="justify-content-center text-center chart-spinner" style="display:none">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Users -->
        <div class="col-md-12 col-xl-4 mt-2">
            <div class="card">
                <div class="card-body">
                    <div>
                        <p class="text-muted mb-0">System Overview</p>
                    </div>
                    <div class="mt-3 text-center">
                        <h2 class="mb-3">@Model.TotalUsers</h2>
                        <p class="text-muted">Total System Users</p>
                        <hr />
                        <div class="mt-4">
                            <p class="mb-2">System Health</p>
                            <div class="progress">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 95%" aria-valuenow="95" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@* @section scripts { *@
@*     <script src="~/js/dashboard/radialChart.js"></script> *@
@*     <script src="~/js/dashboard/inventoryAnalytics.js"></script> *@

@*     <script> *@
@*         // Initialize radial charts *@
@*         $(document).ready(function() { *@
@*             // Products Radial Chart *@
@*             initRadialChart('totalProductsRadialChart', 85, '#34c38f'); *@

@*             // Orders Radial Chart *@
@*             initRadialChart('totalOrdersRadialChart', 75, '#f1b44c'); *@

@*             // Inventory Radial Chart *@
@*             initRadialChart('totalInventoryRadialChart', 65, '#F0006B'); *@
@*         }); *@
@*     </script> *@
@* } *@

@section scripts {
    <script src="~/js/dashboard/radialChart.js"></script>
    <script src="~/js/dashboard/inventoryAnalytics.js"></script>
    <script>
        // Initialize radial charts with dynamic values
        $(document).ready(function() {
            // Calculate percentages based on data
            // For Products - example calculation: use a ratio to calculate percentage
            const totalProducts = @Model.TotalProducts;
            const maxProducts = totalProducts > 0 ? totalProducts * 1.2 : 100; // 20% headroom or default to 100
            const productsPercentage = Math.min(Math.round((totalProducts / maxProducts) * 100), 100);

            // For Orders - calculate percentage based on completed vs total
            const totalOrders = @Model.TotalOrders;
            const completedOrders = @Model.CompletedOrders;
            const ordersPercentage = totalOrders > 0 ? Math.round((completedOrders / totalOrders) * 100) : 0;

            // For Inventory - calculate based on non-low stock items
            const totalInventory = @Model.TotalInventory;
            const lowStockItems = @Model.LowStockItems;
            const healthyInventoryPercentage = totalInventory > 0 ?
                Math.round(((totalInventory - lowStockItems) / totalInventory) * 100) : 100;

            // Initialize charts with calculated values
            initRadialChart('totalProductsRadialChart', productsPercentage, '#34c38f');
            initRadialChart('totalOrdersRadialChart', ordersPercentage, '#f1b44c');
            initRadialChart('totalInventoryRadialChart', healthyInventoryPercentage, '#F0006B');

            // Update the UI to show the percentages
            $('#totalProductsRadialChart .apexcharts-datalabel-label').text(productsPercentage + '%');
            $('#totalOrdersRadialChart .apexcharts-datalabel-label').text(ordersPercentage + '%');
            $('#totalInventoryRadialChart .apexcharts-datalabel-label').text(healthyInventoryPercentage + '%');
        });
    </script>
}